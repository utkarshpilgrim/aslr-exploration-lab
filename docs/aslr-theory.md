Address Space Layout Randomization (ASLR) is a security technique implemented in the Linux kernel (and other OS kernels) to make it harder for attackers to exploit memory corruption vulnerabilities, such as buffer overflows or use-after-free bugs. The core idea is to randomize the memory addresses where key components of a process's address space are loaded, including the stack, heap, libraries (shared objects), and even the program's code segments (in Position-Independent Executables, or PIE).
Theoretically, ASLR works by introducing entropy (randomness) into the virtual memory layout during process creation. When a new process is forked or exec'd, the kernel's memory management unit (MMU) and the virtual memory subsystem (via the mm_struct structure) calculate randomized base addresses for different memory regions. For example, the stack might be offset by a random value within a certain range, and libraries are mapped at unpredictable virtual addresses. This randomness is derived from sources like the kernel's entropy pool (fed by hardware randomness via getrandom() or /dev/urandom), ensuring it's cryptographically secure against prediction.
In Linux, ASLR has evolved through kernel configurations: it's enabled via the CONFIG_RANDOMIZE_BASE option, and its strength can be tuned with sysctl parameters like kernel.randomize_va_space (values: 0=off, 1=conservative, 2=full). Full ASLR (level 2) randomizes not just the stack and mmap regions but also the VDSO (Virtual Dynamic Shared Object) and the executable itself if compiled with PIE. The randomization bits vary by architecture—e.g., on x86_64, the kernel provides about 28 bits of entropy for the mmap base, making brute-force guessing infeasible (2^28 possibilities is over 268 million).
From a security standpoint, ASLR matters because many exploits rely on predictable memory layouts to hijack control flow—e.g., returning to a known libc function address in a ROP (Return-Oriented Programming) chain. By randomizing, ASLR forces attackers to either leak addresses (via info leaks) or brute-force, which can crash the process and alert defenses. However, it's not foolproof; side-channel attacks (like cache timing) or partial randomizations can weaken it. Kernel-level ASLR (KASLR) extends this to the kernel itself, randomizing where kernel code and data are loaded at boot time (via CONFIG_RANDOMIZE_MEMORY), protecting against kernel exploits. In depth, ASLR integrates with the kernel's page table management: during vm_area_struct allocation, the kernel uses arch-specific functions (e.g., arch_randomize_brk()) to shift addresses, ensuring compatibility with hardware like TLBs (Translation Lookaside Buffers). This makes ASLR a probabilistic defense, increasing the cost of exploitation without eliminating vulnerabilities entirely.